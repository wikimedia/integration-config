- project:
    name: search
    project:
        - extra
        - glent
        - highlighter
        - extra-analysis
    release-branch: master
    publishers:
        - email-wikimedia-discovery
        - docker-cleanup
    jobs:
        - '{name}-{project}-maven-java8-docker'
        - '{name}-{project}-maven-java8-docker-site-publish'

- project:
    name: cirrus-streaming-updater
    release-project: search/cirrus-streaming-updater
    release-branch: master
    publishers:
        - email-wikimedia-discovery
        - castor-save-workspace-cache
        - docker-cleanup
    jobs:
        - '{name}-maven-java11-docker'
        - '{name}-maven-java8-docker'
        - '{name}-maven-java11-docker-site-publish'
        - '{name}-maven-release-docker'

- project:
    name: wmf-jvm-utils
    jobs:
        - '{name}-maven-java8-docker'
        - '{name}-maven-java8-docker-site-publish'

- project:
    name: search-mjolnir
    jobs:
        - '{name}-tox-docker-with-sonar':
            name: 'search-mjolnir-patch'
            # branch analysis
            docker_image_var: docker-registry.wikimedia.org/releng/tox-pyspark:0.7.0-s3
            # xgboost takes a while to compile T184754
            # archiva.wikimedia.org is super slow
            build_timeout: 60 # minutes
            sonar_args: >-
                -Dsonar.branch.target="$ZUUL_BRANCH"
                -Dsonar.branch.name="$ZUUL_CHANGE-$ZUUL_PATCHSET"

        - '{name}-tox-docker-with-sonar':
             # postmerge main branch analysis
             name: 'search-mjolnir-main'
             docker_image_var: docker-registry.wikimedia.org/releng/tox-pyspark:0.7.0-s3
             build_timeout: 15 # minutes, maven deps take ~9 minutes with empty cache.
             sonar_args: >-
                 -Dsonar.branch.name="$ZUUL_BRANCH"

        - '{name}-maven-java8-docker':
              docker_image_var: docker-registry.wikimedia.org/releng/java8-mjolnir:0.4.0-s2
              pom: jvm/pom.xml
        - '{name}-maven-java8-docker-site-publish':
              docker_image_var: docker-registry.wikimedia.org/releng/java8-mjolnir:0.4.0-s2
              pom: jvm/pom.xml
              site_dir: src/jvm/target/staging

- project:
    name: wikimedia-discovery-analytics
    jobs:
        - '{name}-tox-docker-with-sonar':
            name: 'wikimedia-discovery-analytics-patch'
            #branch analysis
            docker_image_var: docker-registry.wikimedia.org/releng/tox-pyspark:0.7.0-s3
            sonar_args: >-
                -Dsonar.branch.target="$ZUUL_BRANCH"
                -Dsonar.branch.name="$ZUUL_CHANGE-$ZUUL_PATCHSET"

        - '{name}-tox-docker-with-sonar':
              # postmerge main branch analysis
              name: 'wikimedia-discovery-analytics-main'
              docker_image_var: docker-registry.wikimedia.org/releng/tox-pyspark:0.7.0-s3
              sonar_args: >-
                  -Dsonar.branch.name="$ZUUL_BRANCH"
