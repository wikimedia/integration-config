- project:
    name: search
    project:
        - extra
        - glent
        - highlighter
        - extra-analysis
    release-branch: master
    publishers:
        - email-wikimedia-discovery
        - docker-cleanup
    jobs:
        - '{name}-{project}-maven-java8-docker'
        - '{name}-{project}-maven-java8-docker-site-publish'

- project:
    name: search-xgboost
    jobs:
        - '{name}-maven-java8-docker':
            docker_image_var: docker-registry.wikimedia.org/releng/java8-xgboost:0.4.0
            workdir: '/src/jvm-packages'

- project:
    name: search-mjolnir
    jobs:
        - '{name}-tox-docker':
            docker_image_var: docker-registry.wikimedia.org/releng/tox-pyspark:0.7.0-s1
            build_timeout: 10 # minutes, xgboost takes a while to compile T184754
        # Sadly this does not test the python code with the jvm code, instead
        # using the last release of the jvm code, But it's a good start.
        - '{name}-maven-java8-docker':
            docker_image_var: docker-registry.wikimedia.org/releng/java8-mjolnir:0.4.0
            pom: jvm/pom.xml

- project:
    name: wikimedia-discovery-analytics
    jobs:
        - '{name}-tox-docker-with-sonar':
            name: 'wikimedia-discovery-analytics-patch'
            #branch analysis
            branch: '$ZUUL_CHANGE-$ZUUL_PATCHSET'
            docker_image_var: docker-registry.wikimedia.org/releng/tox-pyspark:0.7.0-s1
            sonar_args: |
                -Dsonar.branch.target="$ZUUL_BRANCH" \
                -Dsonar.branch.name={branch} \
                -Dsonar.verbose=true \

        - '{name}-tox-docker-with-sonar':
              # postmerge master analysis
              name: 'wikimedia-discovery-analytics-master'
              docker_image_var: docker-registry.wikimedia.org/releng/tox-pyspark:0.7.0-s1
              sonar_args: -Dsonar.branch.name="$ZUUL_BRANCH" \
